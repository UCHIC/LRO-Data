{% extends 'river_data/base.html' %}
{% load static %}

{% block styles %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'river_data/stylesheets/site-details.css' %}">
{% endblock %}

{% block content %}
    <h3>{{ site.site_name }}</h3>
    <div class="mdl-cell mdl-cell--12-col">
        <div class="map-container">
            <div id="map"></div>
            <input type="hidden" id="site-latitude" value="{{ site.latitude }}">
            <input type="hidden" id="site-longitude" value="{{ site.longitude }}">
        </div>
    </div>

    <div class="mdl-cell mdl-cell--6-col mdl-cell--12-col-tablet">
        <table id="siteDataTable" class="mdl-data-table mdl-js-data-table mdl-data-table-no-hover shade-first-col"
               data-upgraded=",MaterialDataTable">
            <tr>
                <td><i class="fas fa-user" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Site Code</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.site_code }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-arrows-alt-v" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Latitude</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.latitude|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-arrows-alt-h" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Longitude</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.longitude|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-ellipsis-h" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Lat/Long Datum</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.vertical_datum|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-arrow-up" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Elevation (m)</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.elevation_m|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-city" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">State</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.state|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-flag" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">County</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.county|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-tint" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Watershed</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.watershed|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-circle" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Site Type</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.site_type|default:"-" }}</td>
            </tr>
        </table>
    </div>
    <div class="mdl-cell mdl-cell--6-col mdl-cell--12-col-tablet">
        <div id="imgCarousel" class="carousel slide" data-interval="5000" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                {% for photo in site.photos.all %}
                    <li data-target="#imgCarousel" data-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}"></li>
                {% endfor %}
            </ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                {% for site_image in site.photos.all %}
                    <div class="item {% if forloop.first %}active{% endif %}">
                        <img src="{{ site_image.photo.url }}" alt="{{ site_image.photo.name }}">
                    </div>
                {% empty %}
                    <div class="item active">
                        <img src="https://uwrl.usu.edu/lro/images/index/digitalmap.jpg" alt="blank image">
                    </div>
                {% endfor %}
            </div>

            <!-- Left and right controls -->
            <a class="left carousel-control" href="#imgCarousel" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#imgCarousel" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>

    <h3 class="most-recent-text mdl-cell--12-col">Most Recent Instantaneous Measurements</h3>
{#    <span class="time-warning mdl-cell--12-col">Latest 24 hours shown.</span>#}

    <div class="buttons-toolbar mdl-cell--12-col">
        {% if site.raw_data_download_link %}
        <a class="button-link mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
           href="{{ site.raw_data_download_link }}" target="_blank">
            <i class="material-icons center-icon">cloud_download</i>
            Download Raw Data
        </a>
        {% endif %}
        {% if site.controlled_data_download_link %}
        <a class="button-link mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
           href="{{ site.controlled_data_download_link }}" target="_blank">
            <i class="material-icons center-icon">cloud_download</i>
            Download Quality Controlled Data
        </a>
        {% endif %}
        <a class="button-link mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
           href="/tsa/?sitecode={{ site.site_code }}&view=datasets&plot=false" target="_blank">
            <i class="fas fa-external-link-alt"></i>
            View on Time Series Analyst
        </a>
    </div>
    <div class="mdl-cell--12-col">
        <div class="mdl-grid">
            {% for series in site.active_series %}
                <div class="mdl-cell mdl-cell--4-col-desktop mdl-cell--6-col-tablet mdl-cell--12-col-phone">
                    <div class="plot_box mdl-card mdl-shadow--2dp" data-id="{{ series.identifier }}"
                         data-influx-url="{{ series.influx_values_url }}">
                        <div class="mdl-card__actions mdl-card--border mdl-card__supporting-text">
                            <div class="mdl-grid">
                                <div class="variable-title-wrapper mdl-cell--7-col">
                                    <h6 class="variable-title d-inline"
                                        title="{{ series.variable_name }}">{{ series.variable_name }}</h6>
                                </div>

                                <div class="mdl-cell--6-col">
                                    {#  View on TSA button  #}
                                    <a target="_blank"
                                       href="/tsa/?sitecode={{ site.site_code }}&variablecode={{ series.variable_code }}&view=visualization&plot=true">
                                        <span id="tsa-trigger-{{ forloop.counter0 }}"
                                              class="fas fa-external-link-alt tsa-trigger pull-right text-black"
                                              aria-hidden="false"></span>
                                    </a>
                                    <div class="mdl-tooltip mdl-tooltip--left"
                                         data-mdl-for="tsa-trigger-{{ forloop.counter0 }}">
                                        Open in Time Series Analyst
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mdl-card__supporting-text mdl-card--border full-width">
                            <div id="graph{{ forloop.counter0 }}"
                                 class="graph-container">
                            </div>
                            <div class="variable-data">
                                <div class="mdl-grid">
                                    <div>
                                        <small class="text-muted">Last observation </small><br>
                                        <span class="last-observation"></span>
                                    </div>
                                    <div class="column-expander"></div>
                                    <div>
                                        <h3 class="last-value"></h3>
                                        <h6 class="unit">({{ series.unit_abbreviation }})</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="no_data_msg"><p>Sorry. No data found for this site</p></div>
            {% endfor %}
        </div>

    <div class="warning-text">
        <span>WARNING: These data may be provisional and subject to revision. The data are released on the condition that Utah State University may not be held liable for any damages resulting from their use.</span>
    </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'river_data/scripts/windrose.js' %}"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="{% static 'river_data/scripts/site-details.js' %}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ5EbbKQj8jxJ83DMDazMBScJ1ZkuaIAE&callback=initMap">
    </script>
{% endblock %}

