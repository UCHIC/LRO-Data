{% extends 'river_data/base.html' %}
{% load static %}

{% block styles %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'river_data/stylesheets/site-details.css' %}">
{% endblock %}

{% block content %}
    <h3>{{ site.site_name }}</h3>
    <div class="mdl-cell mdl-cell--12-col">
        <div class="map-container">
            <div id="map"></div>
            <input type="hidden" id="site-latitude" value="{{ site.latitude }}">
            <input type="hidden" id="site-longitude" value="{{ site.longitude }}">
        </div>
    </div>

    <div class="mdl-cell mdl-cell--6-col mdl-cell--12-col-tablet">
        <table id="siteDataTable" class="mdl-data-table mdl-js-data-table mdl-data-table-no-hover shade-first-col"
               data-upgraded=",MaterialDataTable">
            <tr>
                <td><i class="fas fa-user" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Site Code</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.site_code }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-arrows-alt-v" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Latitude</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.latitude|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-arrows-alt-h" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Longitude</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.longitude|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-ellipsis-h" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Lat/Long Datum</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.vertical_datum|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-arrow-up" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Elevation (m)</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.elevation_m|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-city" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">State</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.state|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-flag" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">County</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.county|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-tint" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Watershed</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.watershed|default:"-" }}</td>
            </tr>
            <tr>
                <td><i class="fa fa-circle" aria-hidden="true"></i></td>
                <td class="mdl-data-table__cell--non-numeric">Site Type</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.site_type|default:"-" }}</td>
            </tr>
        </table>
    </div>
    <div class="mdl-cell mdl-cell--6-col mdl-cell--12-col-tablet">
        <div id="imgCarousel" class="carousel slide" data-interval="5000" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                <li data-target="#imgCarousel" data-slide-to="0" class="active"></li>
                <li data-target="#imgCarousel" data-slide-to="1"></li>
                <li data-target="#imgCarousel" data-slide-to="2"></li>
            </ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                <div class="item active">
                    <img src="../../static/image1.png">
                </div>

                <div class="item">
                    <img src="../../static/river_data/images/image2.png">
                </div>

                <div class="item">
                    <img src="../../static/river_data/images/image3.png">
                </div>
            </div>

            <!-- Left and right controls -->
            <a class="left carousel-control" href="#imgCarousel" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#imgCarousel" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>

    <h3 class="mdl-cell--12-col">Most Recent Instantaneous Measurements</h3>

    <div class="mdl-cell--12-col">
        <div>Latest 24 hours shown.</div>
        <div class="mdl-grid">
            {% for series in site.series.all %}
            {% if series.variable_code == "WindSp_Avg" or series.variable_code == "WindSp_S_WVT" %}
                <div class="data_box" id="windrose_box" style="height: 310px;"></div>
            {% elif series.variable_code == "WindDir_Avg" or series.variable_code == "WindDir_D1_WVT" %}
                <!-- no need to plot anything for wind direction -->
            {% else %}
                <div class="mdl-cell mdl-cell--4-col-desktop mdl-cell--6-col-tablet mdl-cell--12-col-phone">
                    <div class="plot_box mdl-card mdl-shadow--2dp" data-id="{{ series.identifier }}"
                         data-influx-url="{{ series.influx_values_url }}">
                        <div class="mdl-card__actions mdl-card--border mdl-card__supporting-text">
                            <div class="mdl-grid">
                                <div class="variable-title-wrapper">
                                    <h6 class="variable-title d-inline"
                                        title="{{ series.variable_name }}">{{ series.variable_name }}</h6>
                                </div>

                                <div>
                                    {#  View on TSA button  #}
                                    <a target="_blank"
                                       href="{{ tsa_url }}?sitecode={{ site.sampling_feature_code }}&variablecode={{ sensor.sensor_output.variable_code }}&view=visualization&plot=true">
                                        <span id="tsa-trigger-{{ forloop.counter0 }}"
                                              class="fa fa-external-link tsa-trigger pull-right text-black"
                                              aria-hidden="false"></span>
                                    </a>
                                    <div class="mdl-tooltip mdl-tooltip--left"
                                         data-mdl-for="tsa-trigger-{{ forloop.counter0 }}">
                                        Open in Time Series Analyst
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mdl-card__supporting-text mdl-card--border full-width">
                            <div id="graph{{ forloop.counter0 }}"
                                 class="graph-container">
                            </div>
                            <div class="variable-data">
                                <div class="mdl-grid">
                                    <div>
                                        <small class="text-muted">Last observation </small><br>
                                        <span class="last-observation"></span>
                                    </div>
                                    <div class="column-expander"></div>
                                    <div>
                                        <h3 class="last-value"></h3>
                                        <h6 class="unit">({{ series.unit_abbreviation }})</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% empty %}
            <div class="no_data_msg"><p>Sorry. No data found for this site</p></div>
        {% endfor %}
        </div>

        <!-- This table is used with the windrose plot, don't ever modify it!!-->

        <div style="display:none">
            <!-- Source: http://or.water.usgs.gov/cgi-bin/grapher/graph_windrose.pl -->
            <table id="freq" border="0" cellspacing="0" cellpadding="0">
                <tr nowrap bgcolor="#CCCCFF">
                    <th colspan="9" class="hdr">Table of Frequencies (percent)</th>
                </tr>
                <tr nowrap bgcolor="#CCCCFF" id="ranges">
                    <th class="freq">Direction</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq">Total</th>
                </tr>
                <tr nowrap id="n">
                    <td class="dir">N</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="nne">
                    <td class="dir">NNE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="ne">
                    <td class="dir">NE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="ene">
                    <td class="dir">ENE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="e">
                    <td class="dir">E</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="ese">
                    <td class="dir">ESE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="se">
                    <td class="dir">SE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="sse">
                    <td class="dir">SSE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="s">
                    <td class="dir">S</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="ssw">
                    <td class="dir">SSW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="sw">
                    <td class="dir">SW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="wsw">
                    <td class="dir">WSW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="w">
                    <td class="dir">W</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="wnw">
                    <td class="dir">WNW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="nw">
                    <td class="dir">NW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="nnw">
                    <td class="dir">NNW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="total">
                    <td class="totals">Total</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">&nbsp;</td>
                </tr>
            </table>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'river_data/scripts/windrose.js' %}"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="{% static 'river_data/scripts/site-details.js' %}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ5EbbKQj8jxJ83DMDazMBScJ1ZkuaIAE&callback=initMap">
    </script>
{% endblock %}

