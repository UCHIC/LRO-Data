{% extends 'river_data/base.html' %}
{% load static %}

{% block styles %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'river_data/stylesheets/site-details.css' %}">
{% endblock %}

{% block content %}
    <div class="mdl-card mdl-cell mdl-cell--12-col">
        <div class="mdl-card__supporting-text">
            <h4>{{ site.site_name }}</h4>
        </div>
        <div class="map-container">
            <div id="map"></div>
            <input type="hidden" id="site-latitude" value="{{ site.latitude }}">
            <input type="hidden" id="site-longitude" value="{{ site.longitude }}">
        </div>
        <table class="mdl-data-table mdl-js-data-table mdl-data-table-no-hover full-width shade-first-col"
               data-upgraded=",MaterialDataTable">
            <tr>
                <td class="mdl-data-table__cell--non-numeric">
                    <i class="fa fa-user-o" aria-hidden="true"></i> Site Code
                </td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.site_code }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric">
                    <i class="fa fa-arrows-v" aria-hidden="true"></i> Latitude
                </td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.latitude|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric">
                    <i class="fa fa-arrows-h" aria-hidden="true"></i> Longitude
                </td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.longitude|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric">
                    <i class="fa fa-ellipsis-h" aria-hidden="true"></i> Lat/Long Datum
                </td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.vertical_datum|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric">
                    <i class="fa fa-long-arrow-up" aria-hidden="true"></i> Elevation (m)
                </td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.elevation_m|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric"> State</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.state|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric"> County</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.county|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric"> Watershed</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.watershed|default:"-" }}</td>
            </tr>
            <tr>
                <td class="mdl-data-table__cell--non-numeric"> Site Type</td>
                <td class="mdl-data-table__cell--non-numeric">{{ site.site_type|default:"-" }}</td>
            </tr>
        </table>
    </div>
    <div class=""></div>
    <div class="mdl-card mdl-cell mdl-cell--12-col">
        <div class="mdl-card__supporting-text">
            <h5>Most Recent Instantaneous Measurements</h5>
            Latest 24 hours shown.
        </div>
        <div class="mdl-grid">
            {% for series in site.series.all %}
            {% if series.variable_code == "WindSp_Avg" or series.variable_code == "WindSp_S_WVT" %}
                <div class="data_box" id="windrose_box" style="height: 310px;"></div>
            {% elif series.variable_code == "WindDir_Avg" or series.variable_code == "WindDir_D1_WVT" %}
                <!-- no need to plot anything for wind direction -->
            {% else %}
                <div class="mdl-cell mdl-cell--6-col">
                    <div class="plot_box mdl-card mdl-shadow--2dp" data-id="{{ series.identifier }}"
                         data-influx-url="{{ series.influx_values_url }}">
                        <div class="mdl-card__actions mdl-card--border mdl-card__supporting-text">
                            <div class="grid" style="grid-template-columns: auto auto;">
                                <div>
                                    <h6 class="variable-title d-inline">{{ series.variable_name }}</h6>
                                </div>

                                <div>
                                    {#  View on TSA button  #}
                                    <a target="_blank"
                                       href="{{ tsa_url }}?sitecode={{ site.sampling_feature_code }}&variablecode={{ sensor.sensor_output.variable_code }}&view=visualization&plot=true">
                                        <span id="tsa-trigger-{{ forloop.counter0 }}"
                                              class="fa fa-external-link tsa-trigger pull-right text-black"
                                              aria-hidden="false"></span>
                                    </a>
                                    <div class="mdl-tooltip mdl-tooltip--left"
                                         data-mdl-for="tsa-trigger-{{ forloop.counter0 }}">
                                        Open in Time Series Analyst
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mdl-card__supporting-text mdl-card--border full-width">
                            <div id="graph{{ forloop.counter0 }}"
                                 class="graph-container">
                            </div>
                            <div class="variable-data">
                                <div class="grid" style="grid-template-columns: auto auto">
                                    <div>
                                        <span>Last observation </span><br>
                                        <span class="last-observation"></span>
                                    </div>
                                    <div class="text-right">
                                        <h3 class="last-value" style="margin: 0; color: steelblue;"></h3>
                                        <h6 style="margin-top: 0;" class="unit">
                                            ({{ series.unit_abbreviation }})</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% empty %}
            <div class="no_data_msg"><p>Sorry. No data found for this site</p></div>
        {% endfor %}
        </div>

        <!-- This table is used with the windrose plot, don't ever modify it!!-->

        <div style="display:none">
            <!-- Source: http://or.water.usgs.gov/cgi-bin/grapher/graph_windrose.pl -->
            <table id="freq" border="0" cellspacing="0" cellpadding="0">
                <tr nowrap bgcolor="#CCCCFF">
                    <th colspan="9" class="hdr">Table of Frequencies (percent)</th>
                </tr>
                <tr nowrap bgcolor="#CCCCFF" id="ranges">
                    <th class="freq">Direction</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq"> m/s</th>
                    <th class="freq">Total</th>
                </tr>
                <tr nowrap id="n">
                    <td class="dir">N</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="nne">
                    <td class="dir">NNE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="ne">
                    <td class="dir">NE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="ene">
                    <td class="dir">ENE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="e">
                    <td class="dir">E</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="ese">
                    <td class="dir">ESE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="se">
                    <td class="dir">SE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="sse">
                    <td class="dir">SSE</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="s">
                    <td class="dir">S</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="ssw">
                    <td class="dir">SSW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="sw">
                    <td class="dir">SW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="wsw">
                    <td class="dir">WSW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="w">
                    <td class="dir">W</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="wnw">
                    <td class="dir">WNW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="nw">
                    <td class="dir">NW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap bgcolor="#DDDDDD" id="nnw">
                    <td class="dir">NNW</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                    <td class="data">0.00</td>
                </tr>
                <tr nowrap id="total">
                    <td class="totals">Total</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">0.00</td>
                    <td class="totals">&nbsp;</td>
                </tr>
            </table>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'river_data/scripts/windrose.js' %}"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="{% static 'river_data/scripts/site-details.js' %}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ5EbbKQj8jxJ83DMDazMBScJ1ZkuaIAE&callback=initMap">
    </script>
{% endblock %}

